---
/**
 * CTA Section Component
 * Call-to-action section for landing pages
 */

import type { ProfileId } from '../../data/profiles';

export interface CTAButton {
  text: string;
  href: string;
  icon: string;
  primary?: boolean;
  external?: boolean;
  isContactTrigger?: boolean;
}

interface Props {
  title: string;
  description: string;
  buttons: CTAButton[];
  profileId: ProfileId;
  gradient?: boolean;
}

const { title, description, buttons, profileId, gradient = false } = Astro.props;

// Static color mappings for Tailwind (classes must be complete for purging)
const colorClasses: Record<ProfileId, {
  sectionBg: string;
  sectionBgGradient: string;
  primaryBtn: string;
  primaryBtnText: string;
  secondaryBtnHover: string;
}> = {
  developer: {
    sectionBg: 'bg-blue-600 dark:bg-blue-700',
    sectionBgGradient: 'bg-gradient-to-br from-blue-600 to-blue-700',
    primaryBtn: 'bg-white hover:bg-slate-100',
    primaryBtnText: 'text-blue-600',
    secondaryBtnHover: 'hover:bg-white hover:text-blue-600',
  },
  analista: {
    sectionBg: 'bg-slate-900',
    sectionBgGradient: 'bg-gradient-to-br from-slate-900 to-slate-800',
    primaryBtn: 'bg-white hover:bg-slate-100',
    primaryBtnText: 'text-slate-900',
    secondaryBtnHover: 'hover:bg-white hover:text-slate-900',
  },
  'ia-engineer': {
    sectionBg: 'bg-emerald-600 dark:bg-emerald-700',
    sectionBgGradient: 'bg-gradient-to-br from-emerald-900 to-slate-900',
    primaryBtn: 'bg-emerald-600 hover:bg-emerald-500',
    primaryBtnText: 'text-white',
    secondaryBtnHover: 'hover:bg-emerald-500 hover:text-white',
  },
  freelance: {
    sectionBg: 'bg-orange-600 dark:bg-orange-700',
    sectionBgGradient: 'bg-gradient-to-br from-orange-600 to-orange-700',
    primaryBtn: 'bg-white hover:bg-slate-100',
    primaryBtnText: 'text-orange-600',
    secondaryBtnHover: 'hover:bg-white hover:text-orange-600',
  },
  speaker: {
    sectionBg: 'bg-purple-600 dark:bg-purple-700',
    sectionBgGradient: 'bg-gradient-to-br from-purple-600 to-purple-700',
    primaryBtn: 'bg-white hover:bg-slate-100',
    primaryBtnText: 'text-purple-600',
    secondaryBtnHover: 'hover:bg-white hover:text-purple-600',
  },
};

const colors = colorClasses[profileId];
const bgClass = gradient ? colors.sectionBgGradient : colors.sectionBg;

// Icon SVG paths
const iconPaths: Record<string, { path: string; filled: boolean }> = {
  'fas fa-file-pdf': { 
    path: 'M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z', 
    filled: true 
  },
  'fas fa-envelope': { 
    path: 'M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z', 
    filled: false 
  },
  'fas fa-calendar': { 
    path: 'M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z', 
    filled: false 
  },
  'fab fa-linkedin': { 
    path: 'M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z', 
    filled: true 
  },
};

const defaultIcon = { 
  path: 'M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1', 
  filled: false 
};

// Process buttons with icon info
const processedButtons = buttons.map(button => ({
  ...button,
  iconInfo: iconPaths[button.icon] || defaultIcon,
}));
---

<section id="contacto" class:list={['py-20 text-white', bgClass]}>
  <div class="max-w-4xl mx-auto px-4 text-center">
    <h2 class="text-4xl font-bold mb-6">{title}</h2>
    <p class="text-xl mb-8 opacity-90">
      {description}
    </p>
    <div class="flex flex-wrap justify-center gap-4">
      {processedButtons.map((button) => (
        button.isContactTrigger ? (
          <button 
            data-contact-trigger
            class:list={[
              'px-8 py-4 rounded-xl font-bold transition inline-flex items-center cursor-pointer',
              button.primary 
                ? [colors.primaryBtn, colors.primaryBtnText]
                : ['border-2 border-white text-white', colors.secondaryBtnHover]
            ]}
          >
            <svg class="w-5 h-5 mr-2" fill={button.iconInfo.filled ? 'currentColor' : 'none'} stroke={button.iconInfo.filled ? 'none' : 'currentColor'} viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={button.iconInfo.path} />
            </svg>
            {button.text}
          </button>
        ) : (
          <a 
            href={button.href}
            target={button.external ? '_blank' : undefined}
            rel={button.external ? 'noopener noreferrer' : undefined}
            class:list={[
              'px-8 py-4 rounded-xl font-bold transition inline-flex items-center',
              button.primary 
                ? [colors.primaryBtn, colors.primaryBtnText]
                : ['border-2 border-white text-white', colors.secondaryBtnHover]
            ]}
          >
            <svg class="w-5 h-5 mr-2" fill={button.iconInfo.filled ? 'currentColor' : 'none'} stroke={button.iconInfo.filled ? 'none' : 'currentColor'} viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={button.iconInfo.path} />
            </svg>
            {button.text}
          </a>
        )
      ))}
    </div>
  </div>
</section>
