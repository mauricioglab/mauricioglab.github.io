<div class="chuck-facts-grid" aria-label="Chuck Norris Facts Section">
    <div class="chuck-column">
        <article class="article">
            <h3>Chuck News</h3>
            <p id="chuck-fact-1">Loading the truth...</p>
        </article>
        <article class="article">
            <h3>Chuck's Law</h3>
            <p id="chuck-fact-2">Loading legend...</p>
        </article>
        <article class="article">
            <h3>Deep Knowledge</h3>
            <p id="chuck-fact-3">Extracting wisdom...</p>
        </article>
    </div>
    <div class="chuck-column">
        <article class="article">
            <h3>Breaking Fact</h3>
            <p id="chuck-fact-4">Loading power...</p>
        </article>
        <article class="article">
            <h3>The Roundhouse Report</h3>
            <p id="chuck-fact-5">Loading impact...</p>
        </article>
        <article class="article">
            <h3>Ultimate Truth</h3>
            <p id="chuck-fact-6">Consulting the master...</p>
        </article>
    </div>
</div>

<script>
    import { getCachedData, setCachedData } from "../../utils/cache";

    const FALLBACK = "Chuck Norris doesn't need an API. He just knows.";
    const API = "https://api.chucknorris.io/jokes/random";
    const CACHE_KEY = "chuck-facts";

    function renderFacts(facts: string[]) {
        facts.forEach((text, i) => {
            const el = document.getElementById(`chuck-fact-${i + 1}`);
            if (el) el.innerText = text;
        });
    }

    async function fetchChuckFacts() {
        const cached = getCachedData<string[]>(CACHE_KEY);
        if (cached?.length === 6) {
            renderFacts(cached);
            return;
        }

        const results = await Promise.allSettled(
            Array.from({ length: 6 }, () =>
                fetch(API).then((r) => r.json()).then((d) => d.value),
            ),
        );
        const facts = results.map((r) =>
            r.status === "fulfilled" ? r.value : FALLBACK,
        );
        setCachedData(CACHE_KEY, facts);
        renderFacts(facts);
    }

    document.addEventListener("DOMContentLoaded", fetchChuckFacts);
</script>

<style>
    .chuck-facts-grid {
        display: flex;
        gap: 20px;
        width: 100%;
    }

    .chuck-column {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .article {
        border-left: 3px solid #000000;
        padding-left: 12px;
        padding-right: 15px;
    }

    .article h3 {
        font-size: 15px;
        font-weight: bold;
        margin-bottom: 8px;
    }

    .article p {
        font-size: 13px;
        line-height: 1.5;
    }

    @media (max-width: 600px) {
        .chuck-facts-grid {
            flex-direction: column;
        }
    }
</style>
