---
import BaseTailwind from "../layouts/BaseTailwind.astro";
import CurrencyConverter from "../components/main-page/CurrencyConverter.astro";

export const prerender = true;
import WeatherWidget from "../components/main-page/WeatherWidget.astro";
import ChuckFacts from "../components/main-page/ChuckFacts.astro";
import RetroTranslator from "../components/main-page/RetroTranslator.astro";
import AdsSidebar from "../components/main-page/AdsSidebar.astro";
import PokemonBanner from "../components/main-page/PokemonBanner.astro";
import URLShortener from "../components/main-page/URLShortener.astro";
import WantedPoster from "../components/main-page/WantedPoster.astro";

const today = new Date();
const formattedDate = today
	.toLocaleDateString("en-US", { month: "long", day: "numeric" })
	.toUpperCase();
const baseUrl = import.meta.env.BASE_URL;
const b = baseUrl.endsWith("/") ? baseUrl : `${baseUrl}/`;

// Obtener todas las páginas dinámicamente
const glob = import.meta.glob("./**/*.astro");
const keys = Object.keys(glob).filter((k) => 
  k !== "./index.astro" && 
  k !== "./main.astro" &&
  !k.startsWith("./blog/[") && 
  !k.startsWith("./blog/category/[") &&
  k !== "./blog/about/index.astro" &&
  k !== "./blog/search/index.astro" &&
  k !== "./blog/archives/index.astro" &&
  k !== "./blog/privacy/index.astro"
);

function pathToRoute(key: string): { segment: string; name: string; url: string } {
	const raw = key.replace(/^\.\//, "").replace(/\.astro$/, "");
	const segment = raw.endsWith("/index") ? raw.slice(0, -6) : raw;
	const url = `${b}${segment}/`;
	const name = segment.charAt(0).toUpperCase() + segment.slice(1);
	return { segment, name, url };
}

const pages = keys.map(pathToRoute).sort((a, b) => a.segment.localeCompare(b.segment));
---

<BaseTailwind 
	title="Bienvenido a MG Lab"
	description="MG Lab Depot - Herramientas y aplicaciones"
	lang="es"
>
	<div class="container">
			<aside class="sidebar" aria-label="Main Navigation Sidebar">
				<nav class="menu">
					{
						pages.map((p) => (
							<a href={p.url}>{p.name}</a>
						))
					}
				</nav>
				<hr />

				<div class="alf-section" aria-label="Fun corner with ALF">
					<img
						src="https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExMWd2cTd3MXdhd2UwZnlrNTBkYXI2M2JkaWpjNDh5eXVpdDR1cjdxbyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/LLWteC47MmBck/giphy.gif"
						alt="ALF mascot waving"
						class="alf-image"
					/>
					<div class="alf-text">ALF SAYS:<br />"Visit us!"</div>
				</div>

				<hr />

				<CurrencyConverter />

				<hr />

				<WantedPoster />
			</aside>

			<main class="main-content" aria-label="Main Content Area">
				<header class="header">
					<div class="header-inner">
						<h1>Welcome to MG Lab Depot</h1>
						<div class="search-container">
							<form action="https://www.google.com/search" method="get" target="_blank" class="search-form">
								<input
									type="text"
									name="q"
									placeholder="Search Google..."
									class="search-input"
									aria-label="Search Google"
								/>
								<button type="submit" class="search-btn">GO</button>
							</form>
						</div>
						<div class="date" aria-label="Current date">
							{formattedDate}
						</div>
					</div>
				</header>

				<div class="content-area">
					<PokemonBanner />

					<br />
					<div class="whats-hot-header">▼ What's Hot</div>
					<br />

					<ChuckFacts />

					<hr />

					<div class="translator-shortener-container">
						<div class="translator-wrapper">
							<RetroTranslator />
						</div>
						<div class="shortener-wrapper">
							<URLShortener />
						</div>
					</div>
				</div>

				<footer class="footer">
					<hr />
					<p><a href={baseUrl}>← Volver al inicio</a></p>
				</footer>
			</main>

			<AdsSidebar class="right-sidebar">
				<WeatherWidget slot="weather" />
			</AdsSidebar>
		</div>

		<style is:global>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}
			body {
				font-family: "Times New Roman", Times, serif;
				background-color: #ffffff;
				color: #000;
				overflow-x: hidden;
			}

			.container {
				display: flex;
				width: 100%;
				min-height: 100vh;
			}

			.sidebar {
				flex: 0 0 165px;
				background-color: #990000;
				color: #ffffff;
				padding: 10px;
				font-family: Arial, Helvetica, sans-serif;
			}

			.menu a {
				color: #ffffff;
				text-decoration: none;
				padding: 8px 5px;
				font-size: 13px;
				font-weight: bold;
				display: block;
			}
			.menu a:hover {
				background-color: #bb0000;
			}

			.sidebar hr {
				border: none;
				border-top: 2px solid #ffffff;
				margin: 15px 0;
			}
			.sites-title {
				font-size: 13px;
				font-weight: bold;
				margin-bottom: 8px;
			}
			.sites-section select {
				width: 100%;
				padding: 4px;
				border: 2px inset #999;
			}

			.alf-section {
				margin-top: 20px;
				text-align: center;
				padding: 10px;
				background-color: #880000;
				border: 2px solid #ffff00;
				display: flex;
				flex-direction: column;
				align-items: center;
			}
			.alf-image {
				width: 120px;
				border: 2px solid #000;
				margin-bottom: 8px;
				display: block;
				margin-left: auto;
				margin-right: auto;
			}
			.alf-text {
				font-size: 12px;
				font-weight: bold;
				color: #ffff00;
				line-height: 1.4;
			}

			.main-content {
				flex: 1;
				background-color: #ffffff;
				display: flex;
				flex-direction: column;
			}

			.header {
				padding: 15px;
				background-color: #f0f0f0;
				border-bottom: 2px solid #000;
			}

			.header-inner {
				display: flex;
				justify-content: space-between;
				align-items: center;
				gap: 15px;
			}

			.header h1 {
				font-size: 36px;
				font-weight: normal;
				margin-left: 15px;
				font-family: "Times New Roman", Times, serif;
			}

			.search-container {
				flex: 1;
				max-width: 300px;
			}

			.search-form {
				display: flex;
				gap: 4px;
			}

			.search-input {
				flex: 1;
				padding: 4px 8px;
				border: 2px inset #c0c0c0;
				background-color: #fff;
				color: #000;
				font-size: 11px;
				font-family: Arial, sans-serif;
			}

			.search-input:focus {
				outline: 1px dotted #000;
				outline-offset: -2px;
			}

			.search-btn {
				padding: 4px 12px;
				background: linear-gradient(to bottom, #ece9d8 0%, #d4d0c8 100%);
				border: 2px outset #ece9d8;
				color: #000;
				font-size: 10px;
				font-weight: bold;
				font-family: "MS Sans Serif", "Tahoma", sans-serif;
				cursor: pointer;
				text-shadow: 1px 1px 0 rgba(255, 255, 255, 0.5);
			}

			.search-btn:active {
				border-style: inset;
				background: linear-gradient(to bottom, #d4d0c8 0%, #ece9d8 100%);
			}

			.date {
				background-color: #000;
				color: #fff;
				padding: 5px 15px;
				font-size: 11px;
				font-weight: bold;
				font-family: Arial, sans-serif;
			}

			.content-area {
				padding: 20px;
				flex: 1;
			}

			.whats-hot-header {
				background-color: #ffcc00;
				border: 2px solid #000;
				padding: 6px 12px;
				font-size: 13px;
				font-weight: bold;
				margin-bottom: 10px;
				display: inline-block;
			}

			.translator-shortener-container {
				display: flex;
				gap: 20px;
				align-items: flex-start;
			}

			.translator-wrapper {
				flex: 1;
			}

			.shortener-wrapper {
				flex: 0 0 200px;
			}

			@media (max-width: 768px) {
				.translator-shortener-container {
					flex-direction: column;
				}

				.shortener-wrapper {
					flex: 1;
					width: 100%;
				}

				.header-inner {
					flex-wrap: wrap;
				}

				.search-container {
					max-width: 100%;
					order: 3;
					width: 100%;
				}
			}

			.footer {
				padding: 20px;
				text-align: center;
				margin-top: auto;
			}
			a {
				color: #00f;
				text-decoration: underline;
			}
			a:hover {
				color: #f00;
			}

			hr {
				border: none;
				border-top: 1px solid #ccc;
				margin: 20px 0;
			}

			.right-sidebar {
				flex: 0 0 200px;
			}

			@media (max-width: 992px) {
				.container {
					flex-direction: column;
				}
				.sidebar,
				.main-content,
				.right-sidebar {
					width: 100%;
					flex: none;
					border: none;
				}
				.right-sidebar {
					border-top: 2px solid #000;
				}
			}
		</style>
	</div>
</BaseTailwind>
