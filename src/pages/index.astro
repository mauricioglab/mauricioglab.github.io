---
const base = import.meta.env.BASE_URL;
const b = base.endsWith("/") ? base : `${base}/`;

const glob = import.meta.glob("./**/*.astro");
const keys = Object.keys(glob).filter((k) => k !== "./index.astro");

function pathToRoute(key: string): { segment: string; name: string; url: string } {
	const raw = key.replace(/^\.\//, "").replace(/\.astro$/, "");
	const segment = raw.endsWith("/index") ? raw.slice(0, -6) : raw;
	const name = segment.charAt(0).toUpperCase() + segment.slice(1);
	const url = `${b}${segment}/`;
	return { segment, name, url };
}

const pages = keys.map(pathToRoute).sort((a, b) => a.segment.localeCompare(b.segment));
---

<!DOCTYPE html>
<html lang="es">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>MG Lab</title>
		<link rel="icon" type="image/svg+xml" href={`${b}favicon.svg`} />
		<link rel="icon" href={`${b}favicon.ico`} />
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css"
		/>
	</head>
	<body>
		<main class="container">
			<h1>MG Lab</h1>
			<p>Páginas del sitio.</p>
			<figure>
				<table>
					<thead>
						<tr>
							<th>Página</th>
							<th>Link</th>
						</tr>
					</thead>
					<tbody>
						{
							pages.map((p) => (
								<tr>
									<td>{p.name}</td>
									<td>
										<a href={p.url}>Ir →</a>
									</td>
								</tr>
							))
						}
					</tbody>
				</table>
			</figure>
		</main>
	</body>
</html>
