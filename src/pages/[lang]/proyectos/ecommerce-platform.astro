---
import { type Lang, useTranslations } from '@i18n/index';
import { getLanguagePaths } from '@utils/i18n-paths';
import CaseStudyLayout from '@layouts/CaseStudyLayout.astro';
import CaseStudyHeader from '@components/case-study/CaseStudyHeader.astro';
import ProblemSection from '@components/case-study/ProblemSection.astro';
import ProcessTimeline from '@components/case-study/ProcessTimeline.astro';
import SolutionSection from '@components/case-study/SolutionSection.astro';
import MetricsGrid from '@components/case-study/MetricsGrid.astro';
import TechStack from '@components/case-study/TechStack.astro';
import CaseStudyCTA from '@components/case-study/CaseStudyCTA.astro';

export const getStaticPaths = getLanguagePaths;

const { lang } = Astro.params as { lang: Lang };
const content = await useTranslations<any>(lang, 'projects-ecommerce-platform');

const accentColor = 'blue';

// Transform content to component props
const headerStats = [
  { value: content.stats.time.value, label: content.stats.time.label },
  { value: content.stats.products.value, label: content.stats.products.label },
  { value: content.stats.responsive.value, label: content.stats.responsive.label },
];

const headerLinks = [
  { text: content.links.demo, url: 'https://ecommerce-demo.example.com', primary: true },
  { text: content.links.github, url: 'https://github.com/mauriciogdev/ecommerce-platform' },
];

const resultMetrics = [
  { value: content.results.metrics.performance.value, label: content.results.metrics.performance.label },
  { value: content.results.metrics.loadTime.value, label: content.results.metrics.loadTime.label },
  { value: content.results.metrics.uptime.value, label: content.results.metrics.uptime.label },
  { value: content.results.metrics.errors.value, label: content.results.metrics.errors.label },
];

const solutionSubsections = [
  {
    title: content.solution.frontend.title,
    description: content.solution.frontend.description,
    items: [
      { label: content.solution.frontend.items.cart.label, text: content.solution.frontend.items.cart.text },
      { label: content.solution.frontend.items.search.label, text: content.solution.frontend.items.search.text },
      { label: content.solution.frontend.items.checkout.label, text: content.solution.frontend.items.checkout.text },
      { label: content.solution.frontend.items.admin.label, text: content.solution.frontend.items.admin.text },
    ],
  },
  {
    title: content.solution.backend.title,
    description: content.solution.backend.description,
    items: [
      { label: content.solution.backend.items.products.label, text: content.solution.backend.items.products.text },
      { label: content.solution.backend.items.orders.label, text: content.solution.backend.items.orders.text },
      { label: content.solution.backend.items.payments.label, text: content.solution.backend.items.payments.text },
      { label: content.solution.backend.items.users.label, text: content.solution.backend.items.users.text },
    ],
  },
  {
    title: content.solution.database.title,
    description: content.solution.database.description,
    items: content.solution.database.items,
  },
];

const techStackColumns = [
  { title: 'Frontend', items: ['Angular 18', 'TypeScript', 'NgRx (State Management)', 'Tailwind CSS', 'RxJS'] },
  { title: 'Backend', items: ['.NET Core 8', 'C#', 'Entity Framework Core', 'FluentValidation', 'AutoMapper'] },
  { title: content.stack.infrastructure, items: ['SQL Server', 'AWS (S3, CloudFront, ECS)', 'Docker', 'Stripe API', 'GitHub Actions (CI/CD)'] },
];
---

<CaseStudyLayout 
  title={`${content.title} - Case Study`}
  description={content.description}
  lang={lang}
  backUrl={`/${lang}/landing/developer`}
  backText={content.back}
  accentColor={accentColor}
>
  <CaseStudyHeader
    badge={content.badge}
    title={content.title}
    description={content.description}
    stats={headerStats}
    links={headerLinks}
    accentColor={accentColor}
  />

  <hr class="my-16 border-slate-200 dark:border-slate-700" />

  <ProblemSection
    title={content.problem.title}
    intro={content.problem.intro}
    items={content.problem.items}
    accentColor={accentColor}
  />

  <ProcessTimeline
    title={content.process.title}
    phases={content.process.phases}
    accentColor={accentColor}
    showFirstPhaseCode={true}
  />

  <SolutionSection
    title={content.solution.title}
    subsections={solutionSubsections}
  />

  <MetricsGrid
    title={content.results.title}
    metrics={resultMetrics}
    learnings={content.results.learnings}
    accentColor={accentColor}
  />

  <TechStack
    title={content.stack.title}
    columns={techStackColumns}
  />

  <CaseStudyCTA
    title={content.cta.title}
    subtitle={content.cta.subtitle}
    buttonText={content.cta.button}
    accentColor={accentColor}
    secondaryColor="purple"
  />
</CaseStudyLayout>
