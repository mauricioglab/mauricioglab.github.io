---
import { type Lang, useTranslations } from '@i18n/index';
import { getLanguagePaths } from '@utils/i18n-paths';
import CaseStudyLayout from '@layouts/CaseStudyLayout.astro';
import CaseStudyHeader from '@components/case-study/CaseStudyHeader.astro';
import ProblemSection from '@components/case-study/ProblemSection.astro';
import ProcessTimeline from '@components/case-study/ProcessTimeline.astro';
import SolutionSection from '@components/case-study/SolutionSection.astro';
import MetricsGrid from '@components/case-study/MetricsGrid.astro';
import TechStack from '@components/case-study/TechStack.astro';
import CaseStudyCTA from '@components/case-study/CaseStudyCTA.astro';

export const getStaticPaths = getLanguagePaths;

const { lang } = Astro.params as { lang: Lang };
const content = await useTranslations<any>(lang, 'projects-task-manager-ddd');

const accentColor = 'purple';

// Transform content to component props
const headerStats = [
  { value: content.stats.time.value, label: content.stats.time.label },
  { value: content.stats.aggregates.value, label: content.stats.aggregates.label },
  { value: content.stats.coverage.value, label: content.stats.coverage.label },
];

const headerLinks = [
  { text: content.links.demo, url: 'https://taskmanager-demo.example.com', primary: true },
  { text: content.links.github, url: 'https://github.com/mauriciogdev/task-manager-ddd' },
];

const resultMetrics = content.results.metrics.map((m: any) => ({ 
  value: m.value, 
  label: m.label 
}));

const solutionSubsections = [
  {
    title: content.solution.layers.title,
    items: content.solution.layers.items,
  },
  {
    title: content.solution.patterns.title,
    gridItems: content.solution.patterns.items,
  },
  {
    title: content.solution.frontend.title,
    description: content.solution.frontend.description,
    items: content.solution.frontend.items,
  },
];

const techStackColumns = [
  { title: 'Backend', items: ['.NET Core 8', 'C#', 'MediatR (CQRS)', 'Entity Framework Core', 'xUnit (Testing)'] },
  { title: 'Frontend', items: ['React 18', 'TypeScript', 'React Query', 'Tailwind CSS', 'React Beautiful DnD'] },
  { title: content.stack.infrastructure, items: ['PostgreSQL', 'Docker', 'GitHub Actions', 'Swagger/OpenAPI', 'SonarQube (Code Quality)'] },
];
---

<CaseStudyLayout 
  title={`${content.title} - Case Study`}
  description={content.description}
  lang={lang}
  backUrl={`/${lang}/landing/developer`}
  backText={content.back}
  accentColor={accentColor}
>
  <CaseStudyHeader
    badge={content.badge}
    title={content.title}
    description={content.description}
    stats={headerStats}
    links={headerLinks}
    accentColor={accentColor}
  />

  <hr class="my-16 border-slate-200 dark:border-slate-700" />

  <ProblemSection
    title={content.problem.title}
    intro={content.problem.intro}
    items={content.problem.items}
    accentColor={accentColor}
  />

  <ProcessTimeline
    title={content.process.title}
    phases={content.process.phases}
    accentColor={accentColor}
  />

  <SolutionSection
    title={content.solution.title}
    subsections={solutionSubsections}
  />

  <MetricsGrid
    title={content.results.title}
    metrics={resultMetrics}
    learnings={content.results.learnings}
    accentColor={accentColor}
  />

  <TechStack
    title={content.stack.title}
    columns={techStackColumns}
  />

  <CaseStudyCTA
    title={content.cta.title}
    subtitle={content.cta.subtitle}
    buttonText={content.cta.button}
    accentColor={accentColor}
    secondaryColor="blue"
  />
</CaseStudyLayout>
