---
import { type Lang, useTranslations } from '@i18n/index';
import { getLanguagePaths } from '@utils/i18n-paths';
import CaseStudyLayout from '@layouts/CaseStudyLayout.astro';
import CaseStudyHeader from '@components/case-study/CaseStudyHeader.astro';
import ProblemSection from '@components/case-study/ProblemSection.astro';
import ProcessTimeline from '@components/case-study/ProcessTimeline.astro';
import SolutionSection from '@components/case-study/SolutionSection.astro';
import MetricsGrid from '@components/case-study/MetricsGrid.astro';
import TechStack from '@components/case-study/TechStack.astro';
import CaseStudyCTA from '@components/case-study/CaseStudyCTA.astro';

export const getStaticPaths = getLanguagePaths;

const { lang } = Astro.params as { lang: Lang };
const content = await useTranslations<any>(lang, 'projects-microservicios-api');

const accentColor = 'emerald';

// Transform content to component props
const headerStats = [
  { value: content.stats.services.value, label: content.stats.services.label },
  { value: content.stats.uptime.value, label: content.stats.uptime.label },
  { value: content.stats.latency.value, label: content.stats.latency.label },
];

const headerLinks = [
  { text: content.links.github, url: 'https://github.com/mauriciogdev/microservicios-api', primary: true },
  { text: content.links.docs, url: 'https://api-docs.example.com' },
];

const resultMetrics = content.results.metrics.map((m: any) => ({ 
  value: m.value, 
  label: m.label 
}));

const solutionSubsections = [
  {
    title: content.solution.architecture.title,
    items: content.solution.architecture.items,
  },
  {
    title: content.solution.patterns.title,
    gridItems: content.solution.patterns.items,
  },
  {
    title: content.solution.infra.title,
    items: content.solution.infra.items,
  },
];

const infraLabel = lang === 'es' ? 'Infraestructura' : 'Infrastructure';
const techStackColumns = [
  { title: 'Backend', items: ['.NET Core 8', 'C#', 'MassTransit (RabbitMQ)', 'Polly (Resilience)', 'Serilog (Logging)'] },
  { title: infraLabel, items: ['Docker', 'AWS ECS Fargate', 'RabbitMQ', 'PostgreSQL', 'Redis'] },
  { title: content.stack.observability, items: ['CloudWatch', 'X-Ray', 'Grafana', 'Prometheus', 'GitHub Actions (CI/CD)'] },
];
---

<CaseStudyLayout 
  title={`${content.title} - Case Study`}
  description={content.description}
  lang={lang}
  backUrl={`/${lang}/landing/developer`}
  backText={content.back}
  accentColor={accentColor}
>
  <CaseStudyHeader
    badge={content.badge}
    title={content.title}
    description={content.description}
    stats={headerStats}
    links={headerLinks}
    accentColor={accentColor}
  />

  <hr class="my-16 border-slate-200 dark:border-slate-700" />

  <ProblemSection
    title={content.problem.title}
    intro={content.problem.intro}
    items={content.problem.items}
    accentColor={accentColor}
  />

  <ProcessTimeline
    title={content.process.title}
    phases={content.process.phases}
    accentColor={accentColor}
  />

  <SolutionSection
    title={content.solution.title}
    subsections={solutionSubsections}
  />

  <MetricsGrid
    title={content.results.title}
    metrics={resultMetrics}
    learnings={content.results.learnings}
    accentColor={accentColor}
  />

  <TechStack
    title={content.stack.title}
    columns={techStackColumns}
  />

  <CaseStudyCTA
    title={content.cta.title}
    subtitle={content.cta.subtitle}
    buttonText={content.cta.button}
    accentColor={accentColor}
    secondaryColor="blue"
  />
</CaseStudyLayout>
